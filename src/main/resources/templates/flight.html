<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>天空实验室</title>
    <meta name="description"
          content="Flat UI Kit Free is a Twitter Bootstrap Framework design and Theme, this responsive framework includes a PSD and HTML version."/>

    <meta name="viewport" content="width=1000, initial-scale=1.0, maximum-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="flat-ui/dist/css/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="http://cdn.bootcss.com/twitter-bootstrap/2.2.2/css/bootstrap.min.css" rel="stylesheet">-->

    <!-- Loading Flat UI -->
    <link href="flat-ui/dist/css/flat-ui.css" rel="stylesheet">
    <!--<link href="flat-ui/docs/assets/css/flight.css" rel="stylesheet">-->

    <link rel="shortcut icon" href="flat-ui/img/favicon.ico">


    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.10.15/css/jquery.dataTables.css">

    <!-- jQuery -->
    <script type="text/javascript" charset="utf8" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

    <!-- DataTables -->
    <script type="text/javascript" charset="utf8" src="http://cdn.datatables.net/1.10.15/js/jquery.dataTables.js"></script>

    <!-- 引入 ECharts 文件 -->
    <script src="js/echarts.common.min.js"></script>

</head>
<body>
<style>
    body {
        min-height: 100px;
        padding-top: 70px;
    }
</style>

<div class="container">

    <!-- Static navbar -->
    <div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">LunaLab Control Center</span>
                </button>
                <a class="navbar-brand" href="#">天空实验室(Skylab)</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="#">勇气号</a></li>
                    <li class="active"><a href="#about">情报中心</a></li>
                    <li><a href="#contact">联络站</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">行动 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">行动1</a></li>
                            <li><a href="#">行动2</a></li>
                            <li><a href="#">行动3</a></li>
                            <li class="divider"></li>
                            <li class="dropdown-header">Nav header</li>
                            <li><a href="#">待定链接1</a></li>
                            <li><a href="#">待定链接2</a></li>
                        </ul>
                    </li>
                </ul>
            </div><!--/.nav-collapse &ndash;&gt; -->
        </div>
    </div>

    <div class="flight-row">
        <div class="flight-title">
            <h3>机票情报</h3>
        </div>
        <div class="flight-content">
            <p class="mbl">
                其实也没什么好说明的，就是把东西填好了就行了。<br>
                Nothing to explain,just input what you want.Good luck!
            </p>
            <div class="row">
                <div class="col-xs-8">
                    查询日期：
                    <select multiple="multiple" class="form-control multiselect multiselect-default mbl" data-toggle="select" id="targetDate" style="width:81.5%">
                        <option value="0">1</option>
                        <option value="1" selected>2</option>
                        <option value="2" selected>3</option>
                        <option value="3" selected>4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                    </select>
                </div>

                <div class="col-xs-8">
                    查询航班：
                    <select multiple="multiple" class="form-control multiselect multiselect-default mbl" data-toggle="select" id="code" style="width:81.5%">
                        <option value="0">1</option>
                        <option value="1" selected>2</option>
                        <option value="2" selected>3</option>
                        <option value="3" selected>4</option>
                        <option value="4">5</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-4">
                    出发城市：
                    <select class="form-control select select-default mbl" data-toggle="select" id = "dep">
                        <option value="0">My Profile</option>
                        <option value="1">My Friends</option>
                        <option value="2">Messages</option>
                        <option value="3">My Settings</option>
                        <option value="4">Logout</option>
                    </select>
                </div>
                <div class="col-xs-4">
                    目的城市：
                    <select class="form-control select select-default mbl" data-toggle="select" id = "arr">
                        <option value="0">My Profile</option>
                        <option value="1">My Friends</option>
                        <option value="2">Messages</option>
                        <option value="3">My Settings</option>
                        <option value="4">Logout</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-8">
                    <a href="#fakelink" class="btn  btn-primary" style="width:94%" id="search">立即检索</a>
                </div>
            </div>

            <br>

            <pre class="prettyprint mvl">
                <table id="table_id_example" class="compact hover cell-border" >
                    <thead>
                        <tr>
                            <th>操作</th>
                            <th>航班号</th>
                            <th>日期</th>
                            <th>出发时间</th>
                            <th>到达时间</th>
                            <th>飞行时间</th>
                            <th>出发机场</th>
                            <th>到达机场</th>
                            <th>价格</th>
                            <th>采集日时</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Row 1 Data 1</td>
                            <td>Row 1 Data 2</td>
                            <td>Row 1 Data 2</td>
                        </tr>
                    </tbody>
                </table>
            </pre>

            <div id="fui-switch"></div>
        </div> <!-- /.flight-content -->
    </div> <!-- /.flight-row -->

    <!-- Modal -->
    <div class="modal fade" id="message_model" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document"  style="width: 1200px;height:600px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">
                        <span id="message">asdfsdfsdfsdfsdf</span>
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
                    <div id="main" style="width: 100%;height:500px"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
                </div>
            </div>
        </div>
    </div><!--Modal -->

</div><!--Container -->

<footer>
    <div class="container">
        <div class="row">
            <div class="col-xs-7">
                <h3 class="footer-title">欢迎光临</h3>
                <p>您正在登录天空实验室国际空间站...<br/>
                    如果您需要任何帮助，欢迎与我取得联系。<br/>
                    Mail to: <a href="#" target="_blank">gaoxuezhan@gmail.com</a>
                </p>
            </div> <!-- /col-xs-7 -->

            <div class="col-xs-5">
                <div class="footer-banner">
                    <h3 class="footer-title">天空实验室(Skylab)</h3>
                    <ul>
                        <li>沾沾洋洋的家</li>
                        <li>勇气号(Spirit,Mer-A)</li>
                        <li>信息监控</li>
                        <li>电子仪器管理</li>
                        <li>温度湿度分析</li>
                    </ul>
                    Go to: <a href="http://www.gaoxz.com" target="_blank">www.gaoxz.com</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!--<script src="flat-ui/dist/js/vendor/jquery.min.js"></script>-->
<!--<script src="flat-ui/dist/js/vendor/video.js"></script>-->
<script src="flat-ui/dist/js/flat-ui.min.js"></script>
<script src="flat-ui/docs/assets/js/application.js"></script>

<script th:inline="javascript">
    var ctx = [[@{/}]];
</script>
<script data-th-src="@{js/app/login_test.js?v=2}"></script>

<script type="text/javascript">
    // var data1 =  $.parseJSON(data); //此处代码很关键，后台返回的JSON字符串数据ECharts是无法直接解析的，必须
    //解析一下，使他变成JSON对象（JS对象），ECharts才能操作该数据。
    $('#table_id_example').dataTable( {
        "processing": true,
        "paging":   false,
        "ordering": true,
        "info":     false,
        "filter":     false,
//        "data": data,
        columns: [
            { data: null },
            { data: 'code' },
            { data: 'targetDate' },
            { data: 'departureTime' },
            { data: 'arriveTime' },
            { data: 'timeCost' },
            { data: 'departureAirport' },
            { data: 'arriveAirport' },
            { data: 'price' },
            { data: 'updateTime' }
        ],
        "columnDefs" : [ {
            "targets" : 0,//操作按钮目标列
            "data" : null,
            "render" : function(data, type,row) {
                var code = '"' + row.code + '"';
                var targetDate = '"' + row.targetDate + '"';
                var html =  "<a href='javascript:void(0);' onclick='test("+ code + "," + targetDate + ")' class='down btn btn-default btn-xs'><i class='fa fa-arrow-down'></i>历史曲线</a>"
                return html;
            }
        } ],
        language:{
            "sProcessing":   "<img src='img/ajax-loader2.gif'>",
            "sLengthMenu":   "显示 _MENU_ 项结果",
            "sZeroRecords":  "没有匹配结果",
            "sInfo":         "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
            "sInfoEmpty":    "显示第 0 至 0 项结果，共 0 项",
            "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
            "sInfoPostFix":  "",
            "sSearch":       "搜索:",
            "sUrl":          "",
            "sEmptyTable":     "表中数据为空",
            "sLoadingRecords": "                  ", //载入中
            "sInfoThousands":  ",",
            "oPaginate": {
                "sFirst":    "首页",
                "sPrevious": "上页",
                "sNext":     "下页",
                "sLast":     "末页"
            },
            "oAria": {
                "sSortAscending":  ": 以升序排列此列",
                "sSortDescending": ": 以降序排列此列"
            }
        },
        "createdRow": function ( row, data, index ) {
            //价格
            $('td', row).eq(8).css('font-weight',"bold").css("color","red");

            var col;
            var temp;
            //出发机场
            col = 6;
            temp =  $('td', row).eq(col).html();
            temp = temp.replace('国际','');
            temp = temp.replace('机场','');
            $('td', row).eq(col).html(temp);
            //到达机场
            col = 7;
            temp =  $('td', row).eq(col).html();
            temp = temp.replace('国际','');
            temp = temp.replace('机场','');
            $('td', row).eq(col).html(temp);
        },
        "ajax" : {
            url : "/findAll",
            type : "GET",
            dataType : "JSON",
            data: {},
            dataSrc:function(responseJson){
                //这里result和上面jquery的ajax的代码类似，也是可以得到data.json的数据，但是这样的格式，Datatables不能直接使用，这时候需要在这里处理一下
                //直接返回Datatables需要的那部分数据即可，看到这里，大家或许又懂了些什么看到了他的强大和灵活
                console.log(responseJson);
                console.log(typeof(responseJson));
                return responseJson.result;
            },
            error : function(errorMsg) {
                //请求失败时执行该函数
                console.log('服务器开了点小差，请稍后刷新页面!', {icon: 0});
            }
        }

    });

    function test(code, targetDate) {
        drawChart(targetDate,code);
        $("#message").html(code + "_" + targetDate);
        $("#message_model").modal('toggle');
    };

    $("#search").click(function(event) {
        alert($("#targetDate").val());
    });
</script>


<script type="text/javascript">
    function drawChart(targetDate, code){
        /**  -------------首页地图初始化 start----- */
        $.ajax({
            url : "/history",
            type : "POST",
            dataType : "JSON",
            data: {
                "code": code,
                "targetDate": targetDate
            },
            success : function(data) {//这里得到后台Java响应的json数据,即resultJsonMapData
                var myChart = echarts.init(document.getElementById('main'));
                console.log(data);
                console.log(typeof(data));
                var yMin = data.yMin;
                var yMax = data.yMax;

                // var data1 =  $.parseJSON(data); //此处代码很关键，后台返回的JSON字符串数据ECharts是无法直接解析的，必须
                //解析一下，使他变成JSON对象（JS对象），ECharts才能操作该数据。
                option = {
                    title: {
                        text: '历史价格数据'
                    },
                    tooltip: {
                        trigger: 'axis',
                        formatter: function (params) {
                            params = params[0];
                            var date = new Date(params.name);
                            return params.value[0] + ' : ' + params.value[1];
                        },
                        axisPointer: {
                            animation: false
                        }
                    },
                    xAxis: {
                        type: 'time',
                        splitLine: {
                            show: false
                        }
                    },
                    yAxis: {
                        type: 'value',
                        boundaryGap: [0, '100%'],
                        splitLine: {
                            show: false
                        },
                        min: yMin,
                        max: yMax,
                        interval: 300
                    },
                    series: [{
                        name: '模拟数据',
                        type: 'line',
                        showSymbol: false,
                        hoverAnimation: false,
                        data: data.result,
                        smooth: false
                    }]
                };

                myChart.setOption(option);

            },
            error : function(errorMsg) {
                //请求失败时执行该函数
                console.log('服务器开了点小差，请稍后刷新页面!', {icon: 0});
                myChart.hideLoading();
            }
        });

        /**  -------------首页地图初始化 end ----- */

    };
</script>



</body>
</html>
